
# Droplet trajectory simulator inside a lung

This project aims to predict the deposition area of droplets inside a lung.
The Python program consists of two sections: a velocity map generator that computes the velocity map of the airflow inside a bifurcation, and a droplet simulator that predicts the trajectory of a droplet in the previously computed velocity map.

# Prerequisites

Before you begin, ensure you have met the following requirements:

- Python installed
- Required Python packages:
  - NumPy
  - Matplotlib


# Velocity Map Generator

## Overview

This Python script serves as a Velocity Map Generator, capable of visualizing and analyzing fluid velocity within a bifurcation. The script employs numerical methods to compute binary maps, pressure maps, pressure gradient maps, and velocity maps based on specified system parameters.

## Workflow

- **Binary Map Generation:** Creates binary maps representing the geometric characteritic of the bifurcation.
- **Pressure Map Computation:** Solves the Laplace equation to generate the pressure map.
- **Velocity Map Computation:** Calculates the X and Y components of the velocity map using the pressure gradient map.
- **Visualization:** Provides options to display binary maps, pressure maps, and velocity maps.
- **Data Saving:** Allows the user to save generated maps and metadata for further analysis.

## Usage

### Command-line Arguments

- `-input`: Specify the CSV file containing system parameters. Default is "input.csv" with the following parameters that should be in the same order:


	| Parameter                  | Default Value |
	|----------------------------|---------------|
	| Primary diameter (m)       | 0.006         |
	| Secondary diameter (m)     | 0.005         |
	| Inlet length (m)           | 0.01          |
	| Outlet length (m)          | 0.01          |
	| Inner curvature radius (m) | 0.0135        |
	| Outer curvature radius (m) | 0.0005        |
	| Angle (degrees)            | 30            |
	| Viscosity (Pa.s)           | 0.00002       |
	| Inlet pressure (Pa)        | 2             |
	| Outlet pressure (Pa)       | 0             |
	| Step                       | 50            |

You can customize these values in the CSV file to suit your specific requirements. The "Precision" parameter refers to the number of grid squares in width.

- `-display_binary_maps`: Display binary maps if set to `True`. Default is `False`.
- `-display_pressure_map`: Display pressure map if set to `True`. Default is `False`.
- `-display_velocity_map`: Display velocity map if set to `True`. Default is `True`.
- `-save`: Save results to the specified destination folder. Provide the folder name.

### Example Command

```bash
python velocity_map_generator.py -input input.csv -display_binary_maps True -display_pressure_map True -display_velocity_map True -save results
```

When you run the above command, the script will print progress and time information for each step:

```bash
Start computing pressure map ...
	progress : 10.01%
	progress : 20.02%
	.
	.
	.
End computing pressure map in 1.515625 s
```

### Outputs
Results, including binary maps, X and Y components of the velocity map, and metadata, are saved in the specified destination folder.
The plot below illustrates the velocity map with vector representation on the left and the velocity norm map on the right. This example was generated using the default system parameters.


![alt text](outputs_example/velocity_map_example.png?raw=true)


# Droplet Trajectory Simulator

## Overview
This Python script serves to simulat the trajectory of a droplet in a velocity field. The simulator utilizes maps generated by the Velocity Map Generator to model the droplet's movement.

## Workflow
- **Maps loading:** loads the binary map and velocity map generated by the Velocity Map Generator.
- **Trajectory Computation:** Computes the path of the droplet based on specified parameters.
- **Visualization:** Displays the droplet's path overlaid on the velocity field map.

## Usage
1. Ensure the maps folder, containing velocity and binary maps, is at the same level as the script.
2. Adjust simulation parameters using command-line arguments:
    - `-maps_folder`: Name of the folder containing velocity and binary maps.
    - `-droplet_density`: Density of the droplet in kg/m^3.
    - `-droplet_radius`: Radius of the droplet in µm.
    - `-starting_x_coord`: X coordinate of the starting point of the droplet in mm. Minimum value is the step size of the maps.
    - `-starting_point_to_center`: Horizontal distance between the primary branch center and droplet starting point in mm.
    - `-starting_x_velocity`: X component of the starting velocity of the droplet.
    - `-starting_y_velocity`: Y component of the starting velocity of the droplet.

**NOTE** : Ensure correct unit conversions for parameters.

### Maps' Parameters
Default maps loaded are those in the "maps" folder, and their parameters are printed, including primary diameter, secondary diameter, curvature radius, angle, viscosity, inlet/outlet pressure, and step size.

### Droplet's Parameters
Droplet parameters are adapted based on user inputs, including droplet density, radius, starting coordinates, and velocities. They are printed afterward.
Default values are :

| Parameter                  | Default Value
|----------------------------|--------------------
| Droplet density (kg/m^3)   | 997.0
| Droplet radius (µm)        | 5.0
| Starting X coordinate (mm) | 0.108
| Starting Y coordinate (mm) | 8.165
| Starting X velocity (m/s)  | 0.0
| Starting Y velocity (m/s)  | 0.0

### Example
```bash
python Droplet_Trajectory_Simulator.py -maps_folder maps -droplet_density 997 -droplet_radius 5 -starting_x_coord 3 -starting_point_to_center 0.05 -starting_x_velocity 2 -starting_y_velocity 5
```

The plot below illustrates the droplet trajectory using the command above.

![alt text](outputs_example/droplet_trajectory_example.png?raw=true)

## Animation
The file Droplet_Trajectory_Simulator_Animation.py serves to create animations depicting the movement of droplets.

The animation showcased below demonstrates its output :

![alt text](outputs_example/droplet_trajectory_animation.gif?raw=true)

Here is an animation depicting the movement of thousands of droplets as they traverse multiple bifurcation generations :

![alt text](outputs_example/droplets_trajectory_animation.gif?raw=true)